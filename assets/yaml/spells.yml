# spells.yml

# id: burning_hands_1
# level: 1
# save: dex
# display_name: "Burning Hands 1"
# dice: 3d6
# stat_desc: "3d6 damage to a single target. Range: 0"
# general_desc: |
#   As you hold your hands with thumbs touching and figners spread, a thin
#   sheet of flames shoots forth from your outstretched fingertips.
# roles:
#   - wizard
#   - cleric
# when:
#   - battle
#   - explore
# target: enemy (or ally)
# range: 0
# script: |
#   <code ...>

# availabale local variables:
# - spell
# - caster
# - target
# - players
# - enemies (only if when == 'battle')

# available methods:
# - saving_throw?
# - enemy_save?(caster, target)

# level 1 spells

- id: burning_hands_1
  level: 1
  save: dex
  display_name: "Burning Hands LV1"
  dice: 3d6
  stat_desc: "3d6 damage to single target. Range: 0"
  general_desc: |
    As you hold your hands with thumbs touching and fingers spread, a thin
    sheet of flames shoots forth from your outstretched fingertips.
  roles:
    - wizard
  when: battle
  target_type: enemy
  range: 0
  script: |
    saved = enemy_save?(caster, target) if saving_throw?
    damage = roll_dice(dice)
    damage /= 2 if saved
    target.current_hp -= damage

    if saved
      puts "#{target} saved against #{caster}'s' spell!"
      puts
      puts "You hit the #{target} dealing #{damage} damage."
    else
      puts "#{target}'s save against #{caster}'s spell failed!"
      puts
      puts "You hit the #{target} at full power and dealt #{damage} damage."
    end

- id: magic_missile_1
  level: 1
  display_name: "Magic Missile LV1"
  dice: 1d4 + 1
  stat_desc: "3 x (1d4 + 1) damage to single target. Range: 2"
  general_desc: |
    You create three glowing darts of magical force. After a brief moment
    suspended in the air in front of you, they streak forward towards their
    target.
  roles:
    - wizard
  when: battle
  target_type: enemy
  range: 2
  script: |
    damage = roll_dice(dice) + roll_dice(dice) + roll_dice(dice)
    target.current_hp -= damage

    puts "You hit the #{target} dealing #{damage} damage."

- id: shield_1
  level: 1
  display_name: "Shield LV1"
  stat_desc: "Raise your AC by 5 for 1 turn. Range: Self"
  general_desc: |
    An invisible barrier of magical force appears, protecting you from all
    physical attacks until your next turn.
  roles:
    - wizard
  when: battle
  target_type: self
  script: |
    caster.add_turn_status_effect(:armor_class, 5)

    puts "Barrier is now in force."

- id: sleep_1
  level: 1
  display_name: "Sleep LV1"
  dice: 5d8
  stat_desc: "All enemies in range of target fall unconscious. Range: 1 / AOE: 1"
  general_desc: |
    As you wave your hand across the battlefield, all creatures affected by the
    spell collapse into an unconscious state.
  roles:
    - wizard
  when: battle
  target_type: enemy
  range: 1
  script: |
    enemy_max_hp_affect = roll_dice(dice)
    affected = []

    targets = enemies.select do |enemy|
      enemy.location.distance_to(target.location) <= 1
    end

    targets.each do |enemy|
      if enemy.max_hp <= enemy_max_hp_affect
        enemy.status_effects.add_condition('unconscious')
        affected << enemy
      end
    end

    if affected.empty?
      puts "No creatures were affected."
    else
      affected.each do |enemy|
        puts "#{enemy} (#{enemy.location.display_name}) falls asleep."
      end
    end

- id: cure_wounds_1
  level: 1
  display_name: "Cure Wounds LV1"
  dice: 1d8 + 3
  stat_desc: "Heal single ally 1d8 + 3 HP. Range: 0"
  general_desc: |
    As you place your hands on the wounded, they begin to glow with a gentle
    healing light.
  roles:
    - cleric
  when: battle
  target_type: player
  range: 0
  script: |
    hp = roll_dice(dice)
    target.current_hp += hp

    if target.current_hp > target.max_hp
      target.current_hp = target.max_hp
    end

    puts "#{caster} heals #{target} by #{hp} HPs."

- id: aid_1
  level: 1
  display_name: "Aid LV1"
  stat_desc: "Boosts Max HP of all allies by 5. Range: 0 / AOE: 0"
  general_desc: |
    Your spell bolsters your allies with toughness as resolve.
  roles:
    - cleric
  when: explore
  target_type: player
  range: 0
  script: |
    affected = []
    players.each do |player|
      if player.location.distance_to(target.location) == 0
        player.add_battle_status_effect(:max_up, 5)
        player.current_hp += 5
        affected << player
      end
    end

    affected.map! { |player| player.name }
    puts "#{affected.join(', ')} bolstered!"
